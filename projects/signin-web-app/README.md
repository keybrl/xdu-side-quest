# 签到应用

> Web端 基于地理位置的 以组为单位的 安全的 纯粹而简洁地 用于签到考勤的 微型APP

> 我并不会写README，所以也就随便一写



### 有什么用

该项目是一个Web端签到应用。运行它，可以在浏览器上进行注册、登陆、创建并管理组、加入组、以组为单位组织进行基于地理位置的签到。可用于大学到课考勤。





### 如何使用

该项目主要包含以下文件

```
/Signon
	/static
	/templates
	cache.db
	run.py
	schema.sql
	README.md
```

`/static`主要存放了与项目有关的静态文件，如 CSS样式表、静态的图片、图标等

`/templates`存放应用页面的模版，该项目模版全部使用 *Jinja*

`cache.db`是该项目主要的数据库文件，用于存放应用产生的用户、组信息

`run.py`是该应用服务器的主要代码文件

`schema.sql`是数据库创建部分表时所需的配置文件

`README.md`就是本文



#### 创建数据库文件

如果项目中没有`cache.db`文件，请先执行以下步骤

首先进入该项目文件所在目录，并进入python2.x的交互式命令行

```
cd .\Signon
python
>>>
```

然后执行以下代码

```
import run
run.init_db()
```

此时项目目录中就会有`cache.db`文件



#### 运行该项目

运行该项目只需要简单几步，首先进入该项目文件所在目录

```
cd .\Signon
```

然后，用 *python2.x* 运行run.py文件

```
python run.py
```

如果同时安装了*python2.x* 和 *python3.x*，则可能需要使用如下命令

```
py -2 run.py
```

Linux可能需要管理员权限

```
sudo python run.py
```

或

```
sudo py -2 run.py
```

如提示 *不存在名为 flask 的包* 请先安装 [flask](http://flask.pocoo.org/) (安装方法戳链接)



#### 使用该项目

然后打开浏览器(由于分辨率问题，建议使用手机浏览器访问)，访问运行该软件的主机的IP即可，在本地也可以访问localhost

由于使用80端口，所以访问时可以不加端口号

```
http://xxx.xxx.xxx.xxx/
```

```
http://localhost/
```



#### 兼容性问题

在本地调试和在云服务器调试时使用手机版的 UC浏览器(国际版) 均会造成服务器的原因暂不明的卡顿

在云服务器调试时 QQ浏览器 以及QQ、微信、TIM等腾讯应用内附的浏览器访问时会造成服务器卡顿，关闭 QQ浏览器 的“省流量模式”可以解决该问题

除此之外，Firefox、Chrome、UC浏览器(中国版)、Opera、必应搜索内附的浏览器均未表现出明显的兼容性问题

但Chrome浏览器拒绝一切非https的获取地理位置请求

*除以上提到的浏览器的最新版本外，其余浏览器及以上浏览器的其他版本的兼容性未知*





### 谈谈动机

> 我为什么要写这样一个应用呢？

这个应用的想法主要起源于物理老师要求我们使用手机APP进行到课签到，于是我们被迫安装了一个安装大小130+MB的APP。那是一个大型办公了类APP，包含及丰富的功能，同时也会给系统带来不小的开销，并向系统索要大量的权限，然而我们只需要使用其中很小的一部分，即签到考勤。所以我萌生了制作一个极小的、简洁纯粹的签到应用的想法。

> 有没有发现已经跑题了呢

经过一定的权衡，我选择了使用用户的地理位置信息进行签到。其中主要的原因就是，在web端能调用的系统权限并不是很多，其中地理位置信息是相对容易获取的。同时，这也相对安全和易于控制，比起 WiFi、蓝牙、NFC 使用地理位置信息并不会对系统安全造成什么威胁，最坏的后果仅是用户地理位置信息的泄漏 (当然我也会极力避免这样)。

确定了基本原理，然后就是可行性研究和实现了。首先我稍微了解了如何从web端获取地理位置信息，经过一定的了解，我选择通过使用HTML5的 Geolocation API 获取用户地理位置信息，我并不很关心他如何工作，仅仅了解了如何使用它，然后我先制作了一个简单的用于获取地理位置信息的页面，用于获取测试数据(这个页面在该项目中还被保留着，可以访问`/locate`获取，也可以直接打开项目文件`\Signon\templates\location.html`)，我带着这个页面在各教学楼走来走去，同时着手写一些 *通过经纬度计算两点距离*、*判断是否签到成功* 的函数，并用获取到的数据测试这些函数。这便是核心原理部分的制作。

业务部分的制作几乎也是同时开始的，这个项目的前半部分，即登陆、注册，几乎是照搬我先前写的一个留言板应用，我花了不到半天时间把他改成符合这个项目的样子，然后就是登陆之后的问题了。这一部分的逻辑是我和同为web组又同时是我舍友的 *郑昊鹏* 同学一起讨论产生的(尽管我们因他非要把流程写在纸上，而我喜欢在脑子里想象的分歧浪费了不少时间，但我们的讨论还是十分有成效的)，然后我便按着流程制作各个页面，逐步串联起来，然后完整的应用渐渐成型。

由于没有太多的时间，所以页面设计并没有太多的考究，但是在每个页面上的每一个元素的存在与否都是经过我和郑昊鹏仔细讨论过的，我们力求使这个应用在外观上简洁、高效、目的明确，我们尽量略去了页面上一切无关紧要的内容以实现简洁又保留了足够的信息以方便使用。

虽然我们并不认为这个应用有什么过人之处，但是我们想通过这个应用表达一种想法，一种对简洁、纯粹的追求。(顺便表达对物理老师和部分班委的极大的不满。)





### 参与制作和测试的人员

罗阳豪(本文作者)  参与部分设计、数据处理的研究、全项目的代码实现

郑昊鹏  参与部分设计、数据处理的研究、全过程的测试



##### 感谢

方浩杰  参与早期的测试并给出了我不敢苟同的审美意见并提交了我已经知道的BUG

李振  参与早期的测试



#### 特别感谢

cjr  参与后期的测试并给出了十分简短而极具建设性的意见

